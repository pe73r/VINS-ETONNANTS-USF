<div class="bg-white rounded-md pt-2 pb-4 px-4 md:px-5">
  <!-- product title -->
  <div class="flex gap-1 relative min-h-[60px] items-center">
    <h1 class="font-body-text text-[20px] leading-[24px] md:text-[28px] md:leading-[33px] font-bold line-clamp-2 tracking-tight">
      {{ product.title }}
    </h1>
    {%- if product.tags contains "rouge" -%}
      <div class="relative ml-1">
        {% render 'icon-drop-red' %}
      </div>
    {%- elsif product.tags contains "blanc" -%}
      <div class="relative ml-1">
        {% render 'icon-drop-yellow' %}
      </div>
    {%- elsif product.tags contains "rose" -%}
      <div class="relative ml-1">
        {% render 'icon-drop-pink' %}
      </div>
    {%- endif -%}
  </div>

  <div class="flex items-center justify-between">
    <div class="w-7/12 text-left">
      <!-- Avis verifiés  -->
      <div class="min-h-[15px]">
        <img src="https://cdn.shopify.com/s/files/1/0682/9126/4826/files/Frame_574.png?v=1670359326" alt="">
      </div>

      <!-- Metafield producer -->
      <div class="mt-5">
        <p class="text-xs uppercase font-light">PRODUCTEUR</p>
        <p class="text-base line-clamp-2 min-h-[32px]">
          {{ product.metafields.global.marque }}
        </p>
      </div>

      <!-- Metafield region -->
      {% assign countries = "espagne,autriche,italie,allemagne,croatie,japon,portugal,zelande,etats-unis" | split: ", " %}

      {% unless product.tags contains countries %}
        <div class="mt-3">
          <p class="text-xs uppercase font-light">RÉGION</p>
          <p class="text-base line-clamp-1">
            {% render 'tags-regions' product: product %}
          </p>
          {%- comment -%} <p class="my-2 text-base line-clamp-1 max-h-[32px]">{{ product.metafields.product.region }}</p> {%- endcomment -%}
        </div>
      {% endunless %}


      <!-- Metafield grade -->
      <div class="mt-3">
        <p class="text-xs uppercase font-light">CÉPAGE</p>
        <p class="text-base line-clamp-1 capitalize">
          {% render 'tags-cepage' product: product %}
        </p>
        {%- comment -%} <p class="my-2 text-base line-clamp-1 max-h-[32px]">{{ product.metafields.product.grade }}</p> {%- endcomment -%}
      </div>

      <!-- Metafield style -->
      <div
        class="mt-3">
        <p class="text-xs uppercase font-light">Pays</p>
        <p class="text-base line-clamp-1 capitalize">
          {% render 'tags-countries' product: product %}
        </p>
        {%- comment -%} <p class="my-2 text-base line-clamp-1 max-h-[32px]">{{ product.metafields.product.style }}</p> {%- endcomment -%}
      </div>
    </div>

    <!-- product image -->
    <div class="w-5/12 relative group">
      {%- if product.featured_media -%}
        <tail-carousel
          class="relative max-w-[160px] float-right"
          slidesToShow="md:1"
          data-auto-dots="false">
          <carousel-container>
            <carousel-content>

              {% comment %} {%- for media in product.media -%}
                {% assign position = forloop.index %}
                {% assign image_id = "myImg" | append: position  %}
                <carousel-panel  class="p-0 max-w-[160px] md:max-h-[630px] 2xl:max-h-[800px] object-center">
                {% render 'product-media', media: media, loop: section.settings.enable_video_looping, variant_image: section.settings.hide_variants, class: 'object-top object-cover', id: image_id %}
                </carousel-panel>
              {% endfor %} {% endcomment %}
              {%- for media in product.media -%}
                {%- if media.media_type == 'image' -%}
                  <carousel-panel id="myImg{{ forloop.index }}" class="cursor-pointer">
                    <img
                      src="{{ media | img_url: 'master'}}"
                      alt="{{ media.alt }}"
                      class="myImg">
                  </carousel-panel>
                {% endif %}
              {% endfor %}

            </carousel-content>
          </carousel-container>
          {% if show_dots and product.media.size > 1 %}
            <carousel-dots class="relative flex justify-center items-center mt-3">
              {%- for media in product.media -%}
                <carousel-dot class="w-[8px] h-[8px] m-1 transition-all bg-transparent border rounded-full border-black selected:bg-black selected:border-black selected:w-[12px] selected:h-[12px]"></carousel-dot>
              {%- endfor -%}
            </carousel-dots>
          {% endif %}
          {% if section.settings.show_zoom %}
            <div id="icon-magnifying" class="absolute right-0 bottom-0 cursor-pointer rounded-md border border-gray-300 p-1">
              {% render 'icon-magnifying-glass' %}
            </div>
          {% endif %}
        </tail-carousel>
      {% endif %}

    </div>
  </div>


  <!-- Product carousel modal -->
  <div id="myModal" class="product-modal">
    <div class="block w-11/12 max-w-lg mx-auto">
      <span class="close relative text-right text-4xl text-white flex justify-end cursor-pointer">&times;</span>
      <div class="relative bg-white">
        {%- for media in product.media -%}
          {%- if media.media_type == 'image' -%}
            <img
              class="mediaProductSlides hidden max-w-[350px] mx-auto"
              src="{{ media | img_url: 'master'}}"
              style="width:100%"
              loading="lazy">
          {% endif %}
        {% endfor %}
        <a class="prev" onclick="plusSlides(-1)">{% render 'icon-arrow-left' %}</a>
        <a class="next" onclick="plusSlides(1)">{% render 'icon-arrow-right' %}</a>
      </div>
    </div>
  </div>

  <!-- price mobile -->
  <div
    class="md:hidden flex items-center mt-4"
    id="price-{{ section.id }}"
    role="status"
    {{ block.shopify_attributes }}>
    {%- if product.compare_at_price > product.price -%}
      <span class="block text-[20px] font-extrabold accent">{{ product.price | money }}</span>
      <span class="ml-2 text-base font-light line-through">{{ product.compare_at_price | money }}</span>
    {% else %}
      <span class="block text-xl font-extrabold tracking-tight">{{ product.price | money }}</span>
    {% endif %}
    <span class="block text-xs font-bold ml-3 tracking-tight">Prix par bouteille 75 cl</span>
  </div>
</div>

<script>
  // gpt click and modal

  const modal = document.getElementById("myModal");

  var images = document.getElementsByClassName("myImg");
  var lupa = document.getElementById("icon-magnifying");
  var body = document.querySelector('body');

  for (var i = 0; i < images.length; i++) {
    var img = images[i];
    var modalImg = document.getElementsByClassName("mySlides")[i];
    lupa.onclick = function() {
      modal.style.display = "flex";
      body.style.overflow = 'hidden';
    }
  }

  var closeModal = document.getElementsByClassName("close")[0];

  closeModal.onclick = function() {
    modal.style.display = "none";
    body.style.overflow = 'auto';
  }

  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = "none";
      body.style.overflow = 'auto';
    }
  }

  var product_slides = `{{ product.media.size }}`

  // Carousel Functions
  var slideIndex = 1;
  showSlides(slideIndex);

  function plusSlides(n) {
    showSlides(slideIndex += n);
  }

  function currentSlide(n) {
    showSlides(slideIndex = n);
  }

  function showSlides(n) {
    var i;
    var slides = document.getElementsByClassName("mediaProductSlides");
    if (n > slides.length) {
      slideIndex = 1
    }
    if (n < 1) {
      slideIndex = slides.length
    }
    for (i = 0; i < slides.length; i++) {
      slides[i].style.display = "none";
    }
    slides[slideIndex - 1].style.display = "block";
  }
</script>


<style>

  .product-modal {
    display: none;
    position: fixed;
    z-index: 1;
    justify-content: center;
    align-items: center;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgb(0, 0, 0);
    background-color: rgba(0, 0, 0, 0.8);
    padding-top: 50px;
  }


  .prev,
  .next {
    cursor: pointer;
    position: absolute;
    top: 50%;
    width: auto;
    padding: 16px;
    margin-top: -22px;
    color: black;
    font-weight: bold;
    font-size: 18px;
    transition: 0.6s ease;
    border-radius: 0 3px 3px 0;
    user-select: none;
  }

  .next {
    right: 0;
    border-radius: 3px 0 0 3px;
  }
</style>